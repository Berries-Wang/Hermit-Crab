<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.7.4 (472469)"/><meta name="author" content="流浪者"/><meta name="created" content="2020-08-20 07:39:03 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="yinxiang.win32"/><meta name="source-url" content="https://www.kuboard.cn/learning/k8s-intermediate/service/service-types.html#service-%E7%B1%BB%E5%9E%8B"/><meta name="updated" content="2020-08-23 01:39:38 +0000"/><meta name="content-class" content="yinxiang.markdown"/><title>08.发布Service</title></head><body><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000; margin-top: 14px;">Service发布</h1>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">Kubernetes Service支持不同的访问方式。</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">Service类型</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">Kubernetes中可以通过不同方式发布Service，通过<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">ServiceType</strong>字段指定。该字段的默认值是ClusterIP。可选值有:</p>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">ClusterIP</li>
<li style="line-height: 160%; box-sizing: content-box;">NodePort</li>
<li style="line-height: 160%; box-sizing: content-box;">LoadBalancer</li>
<li style="line-height: 160%; box-sizing: content-box;">ExternalName</li>
<li style="line-height: 160%; box-sizing: content-box;">External IP</li>
</ol>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">ClusterIP</h3>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">默认值，通过集群内部的一个IP地址暴露Service，<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">只在集群内部可以访问</strong></li>
</ul>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">NodePort</h3>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">通过每一个节点上的静态端口(NodePort)暴露Service，同时自动创建ClusterIP类型的访问方式.可以通过以下访问方式进行访问
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">在集群内部通过${ClusterIP}:${Port}访问</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">在集群外部通过${NodeIP}:${NodePort}访问(<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">NodePort也可以在配置文件里面指定</strong>)</li>
</ol>
</li>
</ul>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">NodePort原理</h4>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">对于NodePort类型的Service，Kubernetes为其分配一个<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">节点端口</strong>(对于同一Service，在每一个节点上的节点端口都相同),该端口的范围在初始化apiServer时可通过参数--service-node-port-range指定。节点将该端口上的网络请求转发到对应的Service上。可以通过Service的.spec.ports[ * ].nodePort字段查看该Service分配到的节点端口号.</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">也可以通过nodePort字段来指定节点端口号(必须在--service-node-port-range指定的范围之内)。kubernetes在创建Service的时将使用该节点端口。若该端口被占用，则Service创建不成功。因此，必须要自己规划好端口号.</li>
</ul>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">LoadBalancer</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">之后补充</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">ExternalName</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">之后补充</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">External IP</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">如果有外部IP路由到K8S集群的一个或者多个节点，Kubernetes&nbsp;&nbsp;Service&nbsp;&nbsp;会被暴露给这些&nbsp;&nbsp;externalIPs,K8S Service可以通过这些externalIPs进行访问。externalP 需要由集群管理员在K8S之外配置。<br/>
在Service的定义中，externalIPs可以和任何类型的.spec.type一同使用，如下，可以使用80.11.12.10:80（<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">externalIP:port</strong>）访问my-Service</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">apiVersion:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">v1</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">kind:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">Service</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">metadata:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  name:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">my-service</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">spec:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  selector:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    app:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">MyApp</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  ports:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    - name:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">http</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      protocol:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">TCP</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      port:</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">80</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      targetPort:</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">9376</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  externalIPs:</span>
<span style="color: #d7ba7d; line-height: 160%; box-sizing: content-box;">    -</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">80.11</span><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">.12</span><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">.10</span>
</code></pre>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%23%20Service%E5%8F%91%E5%B8%83%0AKubernetes%20Service%E6%94%AF%E6%8C%81%E4%B8%8D%E5%90%8C%E7%9A%84%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%E3%80%82%0A%23%23%20Service%E7%B1%BB%E5%9E%8B%0AKubernetes%E4%B8%AD%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%B8%8D%E5%90%8C%E6%96%B9%E5%BC%8F%E5%8F%91%E5%B8%83Service%EF%BC%8C%E9%80%9A%E8%BF%87**ServiceType**%E5%AD%97%E6%AE%B5%E6%8C%87%E5%AE%9A%E3%80%82%E8%AF%A5%E5%AD%97%E6%AE%B5%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC%E6%98%AFClusterIP%E3%80%82%E5%8F%AF%E9%80%89%E5%80%BC%E6%9C%89%3A%0A1.%20ClusterIP%0A2.%20NodePort%0A3.%20LoadBalancer%0A4.%20ExternalName%0A5.%20External%20IP%0A%0A%23%23%23%20%20ClusterIP%0A%2B%20%E9%BB%98%E8%AE%A4%E5%80%BC%EF%BC%8C%E9%80%9A%E8%BF%87%E9%9B%86%E7%BE%A4%E5%86%85%E9%83%A8%E7%9A%84%E4%B8%80%E4%B8%AAIP%E5%9C%B0%E5%9D%80%E6%9A%B4%E9%9C%B2Service%EF%BC%8C**%E5%8F%AA%E5%9C%A8%E9%9B%86%E7%BE%A4%E5%86%85%E9%83%A8%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE**%0A%0A-----------------------------------%0A%0A%23%23%23%20NodePort%0A%2B%20%E9%80%9A%E8%BF%87%E6%AF%8F%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E4%B8%8A%E7%9A%84%E9%9D%99%E6%80%81%E7%AB%AF%E5%8F%A3(NodePort)%E6%9A%B4%E9%9C%B2Service%EF%BC%8C%E5%90%8C%E6%97%B6%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BAClusterIP%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F.%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%BB%A5%E4%B8%8B%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%0A%20%20%20%20%201.%20%E5%9C%A8%E9%9B%86%E7%BE%A4%E5%86%85%E9%83%A8%E9%80%9A%E8%BF%87%5C%24%7BClusterIP%7D%3A%24%7BPort%7D%E8%AE%BF%E9%97%AE%0A%20%20%20%20%202.%20%E5%9C%A8%E9%9B%86%E7%BE%A4%E5%A4%96%E9%83%A8%E9%80%9A%E8%BF%87%5C%24%7BNodeIP%7D%3A%24%7BNodePort%7D%E8%AE%BF%E9%97%AE(**NodePort%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E6%8C%87%E5%AE%9A**)%0A%23%23%23%23%20NodePort%E5%8E%9F%E7%90%86%0A%2B%20%E5%AF%B9%E4%BA%8ENodePort%E7%B1%BB%E5%9E%8B%E7%9A%84Service%EF%BC%8CKubernetes%E4%B8%BA%E5%85%B6%E5%88%86%E9%85%8D%E4%B8%80%E4%B8%AA**%E8%8A%82%E7%82%B9%E7%AB%AF%E5%8F%A3**(%E5%AF%B9%E4%BA%8E%E5%90%8C%E4%B8%80Service%EF%BC%8C%E5%9C%A8%E6%AF%8F%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E4%B8%8A%E7%9A%84%E8%8A%82%E7%82%B9%E7%AB%AF%E5%8F%A3%E9%83%BD%E7%9B%B8%E5%90%8C)%2C%E8%AF%A5%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%8C%83%E5%9B%B4%E5%9C%A8%E5%88%9D%E5%A7%8B%E5%8C%96apiServer%E6%97%B6%E5%8F%AF%E9%80%9A%E8%BF%87%E5%8F%82%E6%95%B0--service-node-port-range%E6%8C%87%E5%AE%9A%E3%80%82%E8%8A%82%E7%82%B9%E5%B0%86%E8%AF%A5%E7%AB%AF%E5%8F%A3%E4%B8%8A%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84Service%E4%B8%8A%E3%80%82%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87Service%E7%9A%84.spec.ports%5B%20*%20%5D.nodePort%E5%AD%97%E6%AE%B5%E6%9F%A5%E7%9C%8B%E8%AF%A5Service%E5%88%86%E9%85%8D%E5%88%B0%E7%9A%84%E8%8A%82%E7%82%B9%E7%AB%AF%E5%8F%A3%E5%8F%B7.%0A%2B%20%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87nodePort%E5%AD%97%E6%AE%B5%E6%9D%A5%E6%8C%87%E5%AE%9A%E8%8A%82%E7%82%B9%E7%AB%AF%E5%8F%A3%E5%8F%B7(%E5%BF%85%E9%A1%BB%E5%9C%A8--service-node-port-range%E6%8C%87%E5%AE%9A%E7%9A%84%E8%8C%83%E5%9B%B4%E4%B9%8B%E5%86%85)%E3%80%82kubernetes%E5%9C%A8%E5%88%9B%E5%BB%BAService%E7%9A%84%E6%97%B6%E5%B0%86%E4%BD%BF%E7%94%A8%E8%AF%A5%E8%8A%82%E7%82%B9%E7%AB%AF%E5%8F%A3%E3%80%82%E8%8B%A5%E8%AF%A5%E7%AB%AF%E5%8F%A3%E8%A2%AB%E5%8D%A0%E7%94%A8%EF%BC%8C%E5%88%99Service%E5%88%9B%E5%BB%BA%E4%B8%8D%E6%88%90%E5%8A%9F%E3%80%82%E5%9B%A0%E6%AD%A4%EF%BC%8C%E5%BF%85%E9%A1%BB%E8%A6%81%E8%87%AA%E5%B7%B1%E8%A7%84%E5%88%92%E5%A5%BD%E7%AB%AF%E5%8F%A3%E5%8F%B7.%0A%0A------------------------------------%0A%23%23%23%20LoadBalancer%0A%20%20%20%E4%B9%8B%E5%90%8E%E8%A1%A5%E5%85%85%0A%23%23%23%20%20ExternalName%0A%20%20%20%E4%B9%8B%E5%90%8E%E8%A1%A5%E5%85%85%0A%23%23%23%20External%20IP%0A%E5%A6%82%E6%9E%9C%E6%9C%89%E5%A4%96%E9%83%A8IP%E8%B7%AF%E7%94%B1%E5%88%B0K8S%E9%9B%86%E7%BE%A4%E7%9A%84%E4%B8%80%E4%B8%AA%E6%88%96%E8%80%85%E5%A4%9A%E4%B8%AA%E8%8A%82%E7%82%B9%EF%BC%8CKubernetes%C2%A0Service%C2%A0%E4%BC%9A%E8%A2%AB%E6%9A%B4%E9%9C%B2%E7%BB%99%E8%BF%99%E4%BA%9B%C2%A0externalIPs%2CK8S%20Service%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%BF%99%E4%BA%9BexternalIPs%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%E3%80%82externalP%20%E9%9C%80%E8%A6%81%E7%94%B1%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%91%98%E5%9C%A8K8S%E4%B9%8B%E5%A4%96%E9%85%8D%E7%BD%AE%E3%80%82%0A%E5%9C%A8Service%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%AD%EF%BC%8CexternalIPs%E5%8F%AF%E4%BB%A5%E5%92%8C%E4%BB%BB%E4%BD%95%E7%B1%BB%E5%9E%8B%E7%9A%84.spec.type%E4%B8%80%E5%90%8C%E4%BD%BF%E7%94%A8%EF%BC%8C%E5%A6%82%E4%B8%8B%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A880.11.12.10%3A80%EF%BC%88**externalIP%3Aport**%EF%BC%89%E8%AE%BF%E9%97%AEmy-Service%0A%60%60%60yml%0AapiVersion%3A%20v1%0Akind%3A%20Service%0Ametadata%3A%0A%20%20name%3A%20my-service%0Aspec%3A%0A%20%20selector%3A%0A%20%20%20%20app%3A%20MyApp%0A%20%20ports%3A%0A%20%20%20%20-%20name%3A%20http%0A%20%20%20%20%20%20protocol%3A%20TCP%0A%20%20%20%20%20%20port%3A%2080%0A%20%20%20%20%20%20targetPort%3A%209376%0A%20%20externalIPs%3A%0A%20%20%20%20-%2080.11.12.10%0A%60%60%60</center></body></html>